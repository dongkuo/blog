<!--微信公众号-->
<script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
<script>
  function defaultWxShare() {
    let firstImg = document.querySelector('main img') || document.querySelector('body img')
    let imgUrl = firstImg && firstImg.src ? firstImg.src : window.location.origin + '/static/img/logo.jpg'
    return {title: window.document.title, link: window.location.href, imgUrl};
  }

  axios.get(`https://chuandaoshi.cn/api/weixin/signature?url=${encodeURIComponent(window.location.href)}`)
    .then(resp => {
      wx.config({
        debug: false,
        appId: resp.data.data.appId,
        timestamp: resp.data.data.timestamp,
        nonceStr: resp.data.data.nonceStr,
        signature: resp.data.data.signature,
        jsApiList: ['onMenuShareAppMessage', 'onMenuShareTimeline', 'onMenuShareQQ', 'onMenuShareQZone']
      });
      wx.ready(function () {   //需在用户可能点击分享按钮前就先调用
        wx.onMenuShareTimeline({
          title: 'hello',
          link: 'https://derker.site',
          imgUrl: 'https://derker.site/static/img/logo.jpg',
          success: function () {
          },
          cancel: function () {
          }
        });

        wx.error(function (e) {
          window.alert('微信SDK加载出错:' + e)
        });

        wx.showOptionMenu();
      });

      // wx.ready(function () {
      //   let wxShare = typeof window.wxShare === 'undefined' ? defaultWxShare() : window.wxShare
      //   wx.updateAppMessageShareData(wxShare);
      //   wx.updateTimelineShareData(wxShare);
      // });
      // wx.error(function (res) {
      // });
    })
    .catch(err => {
    })
</script>